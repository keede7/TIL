### 1장. Redis 캐시로 사용하기

유명한 `Caching` 솔루션이며 대부분 `Cache` 용도로 사용한다.

- `Cache` 란 ?

사용자 입장에서 데이터 의 원래 소스보다 더 빠르게, 효율적으로 접근할 수 있는 임시 저장소이다.

대부분 속도향상을 위해 `Cache`를 사용한다.

이 때 이 `Cache`가 유용하게 사용되려면 `Cache` 에 접근하는게 원본에 접근하는 것 보다 빨라야 한다. 

그리고 같은 데이터를 반복적으로 접근할 상황이 많을때 사용하는 것이 좋다.

**즉, 한 번 이상 써야 의미가 있다.**

단순히 `Key` - `Value` 로 저장할 수 있어서 어떤 데이터라도 쉽게 저장할 수 있다.

그리고 모든 데이터를 메모리에 올려두기 떄문에 굉장히 빠르다.

평균 읽기 쓰기 작업속도가 `1m/s` 이다.

**빠른 처리속도**를 가지기 때문에 지연시간 감소 & 처리량 증가가 이루어진다.

---


`Redis` 를 어떻게 배치하냐에 따라서 시스템의 성능에 큰 영향을 미치기도 한다. 이를 `캐싱전략`이라고도 하며, 이것은 데이터의 유형과 해당 데이터에 대한 접근패턴을 잘 고려해서 선택해야 한다.

### 데이터를 읽을 때 사용되는 전략

먼저 애플리케이션에서 데이터를 읽는 작업이 많을때 사용하는 방법인 `look aside` 방법이 있다.

`Cache`로 `Redis` 를 쓸떄 가장 일반적인 방법이다.

애플리케이션은 데이터를 찾을때 `Cache`를 먼저 찾고 데이터가 있으면 `Cache`에서 데이터를 가져오는 작업을 반복한다. **만약 레디스에 찾는 키가 없으면** DB에 접근해서 데이터를 직접 가져온 뒤 다시 `Redis` 에 저장하는 과정을 거쳐야 한다.

따라서 `Cache`는 찾는 데이터가 없을 때만 입력되기 때문에 이를 `lazy Loading` 이라고도 부른다  이 구조를 `Redis`가 다운되더라도 바로 장애로 이루어지지않고 `DB`에서 데이터를 가져올수있따.

하지만, `Cache`로 붙어있던 커넥션이 많았으면 그 커넥션이 모두 `DB`에 접근하기 때문에 갑작스런 부하가 몰릴수 있다. 그래서 이럴 경우 캐시를 새로 투입하거나 `DB`에만 새로운 데이터를 저장했다면 처음에 `Cache Miss`가 엄청 발생하여 성능 저하가 올 수 있다.

이럴때는 미리 `DB`에서 `Cache`로 데이터를 밀어주는 작업을 할수있다.

이것을 `Cache warming` 이라고 한다.

---

### 데이터를 쓸 때 사용되는 전략

1. `Write Around`

`DB`에만 데이터를 저장하는 방식이며 모든 데이터는 `DB`에 저장되고 `Cache Miss`가 발생한 경우에 `Cache`에 데이터를 끌어오게 된다. 이 경우 `Cache` 내 데이터와 `DB`내 데이터가 다를 수 있다는 단점이있다. 

1. `Write-Through`

`DB`에 데이터를 저장할 떄 `Cache`에도 함께 저장하는 방법이다.

`Cache`는 항상 최신정보를 가지고 있다는 장점이 있지만 저장 할 때 마다 두 단계의 스텝을 거쳐야해서 상대적으로 느리다고 볼 수 있다. 그리고 저장되는 데이터가 재사용되지 않을수있는데도 `Cache`에 무조건 넣기 때문에 일종의 리소스 낭비로 볼수도있다.

따라서 이렇게 데이터를 저장할때는 몇 분 또는 몇 시간만 보관하는 의미인 `TTL`을 설정해주는 것이 좋다.

근데 이 값의 관리를 어떻게 하는지가 장애포인트가 될 수 있는데, 그것은 마지막장에서,,

----


### Redis 데이터 타입

`Redis`는 자체적으로 많은 자료구조를 제공하고 있다.

1) `string`

가장 기본적인 데이터 타입이다. `set` 커맨드로 저장할 경우 모두 `string`으로 들어간다.

2) `bitmap` 

`String` 변형이며, `bit` 단위 연산이 가능하다.

3) `list`

데이터를 순서대로 저장하며 `Queue` 로 사용하기 적절하다.

4) `hash`

하나의 키 안에 또 다시 여러 개의 `Field`와 `Value`쌍으로 데이터를 저장한다.

5) `set`

중복되지 않은 문자열의 집합

6) `sorted set`

`set` 처럼 중복되지 않은 값을 저장하지만 모든 값은 **score**라는 숫자값으로 정렬된다.

데이터가 저장될때부터 **score**순서로 저장되며 만약 **score**가 같으면 사전순으로 정렬되어 저장된다.

7) `hyperloglogs`

굉장히 많은 데이터를 다룰때 주로 쓰며 중복되지 않은 값의 개수를 카운트할때 사용된다

8) `Stream`

`log`를 저장하기 가장 좋은 자료구조 이다.


--- 

### 출처 

[Redis 야무지게 사용하기](https://www.youtube.com/watch?app=desktop&v=92NizoBL4uA&ab_channel=NHNCloud)
